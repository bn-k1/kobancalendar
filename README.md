# KobanCalendar

## 概要

交番表に基づいた勤務スケジュールを自動生成・公開・閲覧などするためのツールです。周期的なシフト表で動いている職場であれば、管理者がこれをセットアップし公開することで、職員が自分の勤務を確認しやすくなります。

## まずはじめに

1. 「基準日」時点での「コマ位置」を選択します。わからない場合は、職場の掲示物を確認するか、管理者に聞いてみましょう。
2. あなたの予定が表示されたら、一度**リロード**します。リロードは更新ボタンを押すか、上から下にスワイプすることで実行できます。**リロードしないと次のステップで、空のページが登録されてしまいます。**
3. スマホのホーム画面に追加します。ホーム画面に追加の仕方は、機種やブラウザによります。職場のわかる人に聞いてみましょう。あるいは、ブラウザのブックマークに登録してください。
4. スマホのホーム画面のアイコンやブラウザのブックマークから、いつでも勤務日程を確認できます。

## 機能

### 予定の編集

- 例えば休日出勤が決まった場合などに、変更したい日付を長押しして、他の予定に書き換えることができます。
- 選択肢以外の内容に書き換えたい場合は、**任意入力**を選択してください。
- 編集した予定の削除や非表示化は、「編集済み」から行うことができます。
- **編集した予定はあなたのスマホでしか見れません。ブラウザのローカルストレージを削除した場合、書き込んだ予定が消失します。機種変更なども同様です。**

### 飲みに行くンダー

ビールのアイコンをクリックすると、同僚の方と飲み会できる日を検索できます。

**使い方：**
1. 飲み会が何時以降に始まるか、何ヶ月先まで検索するかを選択します。
2. 掲示物を見て、参加者全員の「基準日のコマ位置」を入力します。何人でもOKです。
3. 全員が行ける日、あるいはそのうち数人が行ける日、があればリストアップされます。詳細を押すと当日、翌日の勤務内容がわかります。

### 検索

予定名を入力すると、それが何時から何時までで、何コマ目なのかが判ります。

### その他

- 共有ボタン - 自分の予定をLINEなどで友達に教えたりできます。
- QRコードボタン - 職場内で、同僚にQRコードを見せてこのアプリを広めることができます。
- ダークモード対応。
- カレンダーのみの表示で印刷できます。

## 注意点

**基準日とコマ位置の組み合わせが正しいことを確認してご使用下さい。**

## インストール手順(管理者用)

1. リポジトリをクローンします。

   ```bash
   git clone https://github.com/bn-k1/kobancalendar.git
   cd kobancalendar
   ```

2. 依存パッケージをインストールします。

   ```bash
   npm install
   ```

3. `config.json`ファイルを設定します。

   ```json
   {
     "default_base_date": "YYYY-MM-DD",
     "position_shift": "XX",
     "next_base_date": "YYYY-MM-DD",
     "schedule_update": "YYYY-MM-DD",
     "custom_holidays": ["MM-DD","MM-DD"],
     "url": "https://yourname.github.io/yourawesomecalendar/"
   }
   ```

   - `default_base_date`: シフト計算の基準日。
   - `next_base_date`: 各員のコマ位置の移動予定日。
   - `schedule_update`: 交番表の内容の変更予定日。
   - `position_shift`: 全員のコマ位置の移動になる数。
   - `custom_holidays`: 独自に設定するカスタム祝日の配列。毎年のお盆休みや年末年始の休みなど。
   - `url`にはURLを記述します(QRコードに使います)。

4. `data/default/`以下の.csv（`weekday.csv`:平日,`saturday.csv`:土曜,`holiday.csv`:日祝）を編集します。

   `subject,startTime,endTime`の形式で、ヘッダーなし、交番表のコマ数=.csvの行数になるように、1コマ目から順に一行ずつ記述してください。全てのファイルの行数は同じである必要があります。

   ```
   遅番,16:00,00:00
   早番,08:00,16:00
   法休,,
   夜勤,00:00,08:00
   ```

5. `event.json`の公休、空、などを色分けしたい文字列に置き換えてください。

6. 過去予定日とデータの整理(`applyUpdate.js`)、.csvを.jsonに変換(`convertCsv.js`)、及びQRコードを生成(`createQr.js`)します。

   ```bash
   npm run build-prep
   ```

7. アプリケーションを実行します。

   ```bash
   # 開発サーバー起動
   npm run dev

   # または本番ビルド
   npm run build

   # github-pages場合
   npm run build-gh-pages
   ```

   ブラウザで`http://localhost:5173`にアクセス。

   またはビルドして`dist/`をウェブサーバーで配信。

   github-pagesの場合は`docs/`を配信。

## 運用方法

以下の方法で各員のコマ位置の入れ替え、交番表の内容の変更に対処できます。

### 各員のコマ位置の移動の場合

**設定手順：**
1. `config.json`の`next_base_date`に移動日を設定
2. `data/default/`の内容を`data/next/`にコピー

**注意点：**
- `schedule_update`は設定しないでください。

基準日選択により、移動前後のスケジュールを使い分けできます。

### 交番表の変更の場合

**設定手順：**
1. `config.json`の`schedule_update`に変更開始日を設定
2. `data/next/`に新しい.csvを作成（形式はインストール手順4と同じ）

**注意点：**
- `next_base_date`は設定しないでください。

指定日以降は自動的に新しいスケジュールデータが適用されます。

### 各員のコマ位置の移動及び交番表の変更

**設定手順：**
1. `config.json`の`next_base_date`に移動日を設定
2. `data/next/`に新しい.csvを作成（形式はインストール手順4と同じ）

**注意点：**
- `schedule_update`は設定しないでください。

### 掲示物の貼り替えなど、基準日の単純な変更

**設定手順：**
1. `config.json`の`default_base_date`を設定しなおす
2. `config.json`の`position_shift`に、全員が移動になるコマ数を入力(任意)

`position_shift`を入力することで、新しいコマ位置のアラートが生成されます。新しい表が見られない職員も、それまで通り予定を確認することができます。

### データ更新時の注意点

- `config.json`と.csv編集後は必ず`npm run build-prep`を実行してください。
- `schedule_update`,`next_base_date`に設定した日付を過ぎた場合、`npm run build-prep`を実行することで、`config.json`の編集およびファイルの移動が自動で行われて`default_base_date`単一になり、`data/next/`のデータは`data/default/`に上書きされて空になります。手動で設定しなおす必要はありません。
- 本番環境では`npm run build`でビルドし直してください。
- 変更前にバックアップを取ることを推奨します。

## デモ

[https://bn-k1.github.io/kobancalendar/](https://bn-k1.github.io/kobancalendar/)

## 備考

本リポジトリの設定ファイル、交番表データはAIによって生成されたサンプルです。特定の組織や企業とは関係ありません。

## ライセンス

MIT License
