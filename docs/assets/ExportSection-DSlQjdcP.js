import{b as O,e as v,w as X,g as _,o as g,i as p,C as U,D as M,F as $,q as V,t as P}from"./vendor-DSOO9KR3.js";import{c as l,I as j,r as L,u as q,E as w,b as h,s as F,i as A,_ as H,l as Y,q as B,g as T,v as z,m as k,A as C,f as J}from"./index-qdmnx7N1.js";import"./utils-BuJoAw0M.js";function K(a){try{return new URL(a).hostname}catch{return"localhost"}}function Q(a,S,e){const s=L(a),r=Date.now();return`${s}-${r}@${e}`}function N(a){return a.toISOString().replace(/[-:]/g,"").replace(/\.\d{3}/,"")}function G(a){return a.toISOString().slice(0,10).replace(/-/g,"")}function W(a){return a.replace(/\\/g,"\\\\").replace(/;/g,"\\;").replace(/,/g,"\\,").replace(/\n/g,"\\n")}function Z(a,S){const e=K(S);let s=["BEGIN:VCALENDAR","VERSION:2.0",`PRODID:-//${e}//${j.PRODUCT_NAME}//${j.LANGUAGE}`,"CALSCALE:GREGORIAN","METHOD:PUBLISH"];return a.forEach(r=>{const{subject:o,startTime:c,endTime:d,date:m}=r,i=l(m),D=Q(i,o,e),x=W(o);if(s.push("BEGIN:VEVENT"),s.push(`UID:${D}`),s.push(`SUMMARY:${x}`),s.push(`DTSTAMP:${N(new Date)}`),c&&d){const[E,f="00"]=c.split(":"),[b,I="00"]=d.split(":"),R=i.hour(parseInt(E,10)).minute(parseInt(f,10)).second(0).toDate(),u=i.hour(parseInt(b,10)).minute(parseInt(I,10)).second(0).toDate();s.push(`DTSTART:${N(R)}`),s.push(`DTEND:${N(u)}`)}else{const f=i.add(1,"day").toDate();s.push(`DTSTART;VALUE=DATE:${G(f)}`),s.push(`DTEND;VALUE=DATE:${G(f)}`)}s.push("END:VEVENT")}),s.push("END:VCALENDAR"),{toString:()=>s.join(`\r
`)}}function ee(a,S,e){const s=typeof a=="string"?a:a.toString(),r=new Blob([s],{type:"text/calendar;charset=utf-8"}),o=URL.createObjectURL(r),c=document.createElement("a"),d=L(S),m=L(e);c.href=o,c.download=`schedule_${d}-${m}.ics`,c.style.display="none",document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(o)}function te(){const a=O(void 0),{calculateScheduleRange:S}=q();function e(s,r,o,c,d,m){try{if(!s)return alert(w.INVALID_STARTNUMBER),!1;a.value=void 0;const i=l(c),D=l(d),x=l(r),E=l(o),f=h(D,1);let b=f;E&&!F(x,E)&&A(E,f)&&(b=E);const I=S(i,b,s,x),R=Z(I,m);return ee(R.toString(),i,D),!0}catch(i){throw console.error(w.ICS_EXPORT_ERROR,i),a.value=i,i}}return{exportError:v(()=>a.value),hasError:v(()=>a.value!==void 0),exportICS:e}}const ae={id:"exportSection",class:"control-group"},se={class:"export-date-selectors"},ne={class:"date-selector-group"},re=["value"],oe={class:"date-selector-group"},ue=["disabled"],le=["value"],ce=["disabled"],ie={__name:"ExportSection",props:{baseDate:{type:[Date,Object],required:!0},nextBaseDate:{type:[Date,Object],required:!0},startPosition:{type:Number,required:!1},url:{type:String,required:!0}},emits:["export","export-complete"],setup(a,{emit:S}){const e=a,s=S,r=O(""),o=O(""),{exportICS:c}=te(),d=v(()=>B(e.baseDate,e.nextBaseDate)?l(e.nextBaseDate):Y()),m=v(()=>T(d.value)),i=v(()=>{const u=h(z(d.value,1),-1);if(D.value){const t=h(e.nextBaseDate,-1);return T(A(u,t)?u:t)}return T(u)}),D=v(()=>!e.nextBaseDate||B(e.baseDate,e.nextBaseDate)?!1:k(e.nextBaseDate,e.baseDate));v(()=>D.value?h(e.nextBaseDate,-1):h(d.value,C.EXPORT_MAX_DAYS-1));const x=v(()=>{const u=[],t=D.value?Math.min(C.EXPORT_MAX_DAYS,e.nextBaseDate.diff(d.value,"day")):C.EXPORT_MAX_DAYS;for(let n=0;n<t;n++){const y=h(d.value,n);if(D.value&&!A(y,e.nextBaseDate))break;u.push({value:T(y),text:J(y)})}return u}),E=v(()=>{if(!r.value)return[];const u=l(r.value);return x.value.filter(t=>{const n=l(t.value);return!(A(n,u)||D.value&&!A(n,e.nextBaseDate))})}),f=v(()=>r.value&&o.value);function b(){r.value=m.value,o.value=i.value}X([()=>e.baseDate,()=>e.nextBaseDate,()=>e.startPosition],()=>{b()},{immediate:!0});function I(){if(o.value){const u=l(r.value),t=l(o.value);(!k(t,u)&&!B(t,u)||D.value&&!A(t,e.nextBaseDate))&&(o.value="")}}function R(){if(f.value)try{c(e.startPosition,l(e.baseDate),l(e.nextBaseDate),l(r.value),l(o.value),e.url),s("export-complete",{success:!0})}catch(u){s("export-complete",{success:!1,error:u})}}return(u,t)=>(g(),_("fieldset",ae,[t[6]||(t[6]=p("legend",null,"エクスポート",-1)),p("div",se,[p("div",ne,[U(p("select",{id:"exportStartDate","onUpdate:modelValue":t[0]||(t[0]=n=>r.value=n),"aria-label":"エクスポート開始日",class:"date-select",onChange:I},[t[2]||(t[2]=p("option",{value:"",disabled:""},"開始日を選択",-1)),(g(!0),_($,null,V(x.value,n=>(g(),_("option",{key:n.value,value:n.value},P(n.text),9,re))),128))],544),[[M,r.value]])]),t[4]||(t[4]=p("span",{class:"date-separator"},"から",-1)),p("div",oe,[U(p("select",{id:"exportEndDate","onUpdate:modelValue":t[1]||(t[1]=n=>o.value=n),"aria-label":"エクスポート終了日",class:"date-select",disabled:!r.value},[t[3]||(t[3]=p("option",{value:"",disabled:""},"終了日を選択",-1)),(g(!0),_($,null,V(E.value,n=>(g(),_("option",{key:n.value,value:n.value},P(n.text),9,le))),128))],8,ue),[[M,o.value]])]),t[5]||(t[5]=p("span",{class:"date-separator"},"まで",-1)),p("button",{id:"exportButton",class:"export-button","aria-label":"ICSをダウンロード",disabled:!f.value,onClick:R}," ダウンロード ",8,ce)])]))}},fe=H(ie,[["__scopeId","data-v-312ae905"]]);export{fe as default};
