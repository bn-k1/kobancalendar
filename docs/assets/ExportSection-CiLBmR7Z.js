import{b as M,e as f,w as j,g as I,o as R,i as D,C as $,D as w,F as L,q as T,t as k}from"./vendor-DSOO9KR3.js";import{c as i,r as q,s as U,I as N,u as V,E as P,b as h,v as F,i as E,_ as G,l as H,q as C,g as A,w as Y,m as X,A as O,f as z}from"./index-nJwFaU7w.js";import{V as J}from"./utils-mma0L5NJ.js";function K(s){try{return new URL(s).hostname}catch{return"localhost"}}function Q(s,n="",e="",l="",r=""){const a=U(s),v=W(`${n}-${e}-${l}`);return`${a}-${v}@${r}`}function W(s){let n=0;if(s.length===0)return n;for(let e=0;e<s.length;e++){const l=s.charCodeAt(e);n=(n<<5)-n+l,n=n&n}return Math.abs(n).toString(16)}function Z(s,n){const e=K(n),l=J({prodId:`-//${e}//${N.PRODUCT_NAME}//${N.LANGUAGE}`});return s.forEach(r=>{const{subject:a,startTime:v,endTime:d,date:_}=r,p=i(_),u=l.createEvent({summary:a,id:Q(p,a,v,d,e)});if(v&&d){const[x,m="00"]=v.split(":"),[b,S="00"]=d.split(":"),y=p.hour(parseInt(x,10)).minute(parseInt(m,10)).second(0).toDate(),B=p.hour(parseInt(b,10)).minute(parseInt(S,10)).second(0).toDate();u.start(y),u.end(B)}else u.allDay(!0),u.start(q(p))}),l}function ee(s,n,e){const l=new Blob([s],{type:"text/calendar;charset=utf-8"}),r=URL.createObjectURL(l),a=document.createElement("a"),v=U(n),d=U(e);a.href=r,a.download=`schedule_${v}-${d}.ics`,a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r)}function te(){const s=M(void 0),{calculateScheduleRange:n}=V();function e(l,r,a,v,d,_){try{if(!l)return alert(P.INVALID_STARTNUMBER),!1;s.value=void 0;const p=i(v),u=i(d),x=i(r),m=i(a),b=h(u,1);let S=b;m&&!F(x,m)&&E(m,b)&&(S=m);const y=n(p,S,l,x),B=Z(y,_);return ee(B.toString(),p,u),!0}catch(p){throw console.error(P.ICS_EXPORT_ERROR,p),s.value=p,p}}return{exportError:f(()=>s.value),hasError:f(()=>s.value!==void 0),exportICS:e}}const ae={id:"exportSection",class:"control-group"},se={class:"export-date-selectors"},ne={class:"date-selector-group"},re=["value"],oe={class:"date-selector-group"},le=["disabled"],ue=["value"],ce=["disabled"],ie={__name:"ExportSection",props:{baseDate:{type:[Date,Object],required:!0},nextBaseDate:{type:[Date,Object],required:!0},startPosition:{type:Number,required:!1},url:{type:String,required:!0}},emits:["export","export-complete"],setup(s,{emit:n}){const e=s,l=n,r=M(""),a=M(""),{exportICS:v}=te(),d=f(()=>C(e.baseDate,e.nextBaseDate)?i(e.nextBaseDate):H()),_=f(()=>A(d.value)),p=f(()=>{const c=h(Y(d.value,1),-1);if(u.value){const t=h(e.nextBaseDate,-1);return A(E(c,t)?c:t)}return A(c)}),u=f(()=>!e.nextBaseDate||C(e.baseDate,e.nextBaseDate)?!1:X(e.nextBaseDate,e.baseDate));f(()=>u.value?h(e.nextBaseDate,-1):h(d.value,O.EXPORT_MAX_DAYS-1));const x=f(()=>{const c=[],t=u.value?Math.min(O.EXPORT_MAX_DAYS,e.nextBaseDate.diff(d.value,"day")):O.EXPORT_MAX_DAYS;for(let o=0;o<t;o++){const g=h(d.value,o);if(u.value&&!E(g,e.nextBaseDate))break;c.push({value:A(g),text:z(g)})}return c}),m=f(()=>{if(!r.value)return[];const c=i(r.value);return x.value.filter(t=>{const o=i(t.value);return!(E(o,c)||u.value&&!E(o,e.nextBaseDate))})}),b=f(()=>r.value&&a.value);function S(){r.value=_.value,a.value=p.value}j([()=>e.baseDate,()=>e.nextBaseDate,()=>e.startPosition],()=>{S()},{immediate:!0});function y(){if(a.value){const c=i(r.value),t=i(a.value);(!X(t,c)&&!C(t,c)||u.value&&!E(t,e.nextBaseDate))&&(a.value="")}}function B(){if(b.value)try{v(e.startPosition,i(e.baseDate),i(e.nextBaseDate),i(r.value),i(a.value),e.url),l("export-complete",{success:!0})}catch(c){l("export-complete",{success:!1,error:c})}}return(c,t)=>(R(),I("fieldset",ae,[t[6]||(t[6]=D("legend",null,"エクスポート",-1)),D("div",se,[D("div",ne,[$(D("select",{id:"exportStartDate","onUpdate:modelValue":t[0]||(t[0]=o=>r.value=o),"aria-label":"エクスポート開始日",class:"date-select",onChange:y},[t[2]||(t[2]=D("option",{value:"",disabled:""},"開始日を選択",-1)),(R(!0),I(L,null,T(x.value,o=>(R(),I("option",{key:o.value,value:o.value},k(o.text),9,re))),128))],544),[[w,r.value]])]),t[4]||(t[4]=D("span",{class:"date-separator"},"から",-1)),D("div",oe,[$(D("select",{id:"exportEndDate","onUpdate:modelValue":t[1]||(t[1]=o=>a.value=o),"aria-label":"エクスポート終了日",class:"date-select",disabled:!r.value},[t[3]||(t[3]=D("option",{value:"",disabled:""},"終了日を選択",-1)),(R(!0),I(L,null,T(m.value,o=>(R(),I("option",{key:o.value,value:o.value},k(o.text),9,ue))),128))],8,le),[[w,a.value]])]),t[5]||(t[5]=D("span",{class:"date-separator"},"まで",-1)),D("button",{id:"exportButton",class:"export-button","aria-label":"ICSをダウンロード",disabled:!b.value,onClick:B}," ダウンロード ",8,ce)])]))}},De=G(ie,[["__scopeId","data-v-312ae905"]]);export{De as default};
