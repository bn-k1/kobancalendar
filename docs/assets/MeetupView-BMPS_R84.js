const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ParticipantsList-Dz-MGBU2.js","assets/vendor-CnP4LbDf.js","assets/index-BUj_DykZ.js","assets/utils-BuJoAw0M.js","assets/index-BgtFyDQQ.css","assets/ParticipantsList-CmpRlaRg.css","assets/ResultsDisplay-B9L0K-sD.js","assets/ResultsDisplay-BsFJHyil.css"])))=>i.map(i=>d[i]);
import{u as $,a as ue,c as E,i as re,b as ee,t as V,_ as de,A as z,d as ce,e as ve,f as k,g as m,U as pe,h as fe,j as G,n as me,k as he,E as B,l as De,m as ge,B as Pe,T as _e,P as be,o as j}from"./index-BUj_DykZ.js";import{b as A,e as H,w as Se,k as ye,c as N,v as h,o as p,l as T,S as q,i as J,x as u,y as K,g as f,f as y,D as Q,F as W,q as X,t as Y,E as Z}from"./vendor-CnP4LbDf.js";import"./utils-BuJoAw0M.js";function Ae(){const R=A({allMatches:[],partialMatches:[]}),{getScheduleForDate:O}=$(),{canAttendMeetup:U}=ue();function D(l,r,d,c){const o={allMatches:[],partialMatches:[]};let i=E(d);const b=E(c);for(;re(i,b);){const s=n(i,l,r);s.availablePositions.length===l.length?o.allMatches.push({date:i,availableCount:s.availablePositions.length,totalCount:l.length,details:s.details}):s.availablePositions.length>0&&o.partialMatches.push({date:i,availableCount:s.availablePositions.length,totalCount:l.length,details:s.details}),i=ee(i,1)}return o.allMatches.sort((s,g)=>V(s.date)-V(g.date)),o.partialMatches.sort((s,g)=>g.availableCount!==s.availableCount?g.availableCount-s.availableCount:V(s.date)-V(g.date)),R.value=o,o}function n(l,r,d){const c={availablePositions:[],details:[]};for(const o of r){const i=O(l,o),b=U(i,d);c.details.push({position:o,schedule:i,isAvailable:b}),b&&c.availablePositions.push(o)}return c}return{searchResults:R,findMeetupDates:D,checkDateForPositions:n}}const Ie={class:"search-controls"},Te={key:1,id:"meetupSettingsSection",class:"control-group"},Ee={class:"form-group"},Me=["value"],Ce={class:"form-group"},Ve=["value"],ke={__name:"MeetupView",setup(R){const O=K(()=>j(()=>import("./ParticipantsList-Dz-MGBU2.js"),__vite__mapDeps([0,1,2,3,4,5]))),U=K(()=>j(()=>import("./ResultsDisplay-B9L0K-sD.js"),__vite__mapDeps([6,2,1,3,4,7]))),D=A(!1),n=A(""),l=A(z.DEFAULT_MEETUP_START_TIME),r=A(z.DEFAULT_SEARCH_PERIOD.toString()),d=A([{position:""}]),{isLoaded:c,initializeApp:o}=ce(),{getDateParam:i,getNumberParam:b,getStringParam:s,getParticipantsFromParams:g,updateMeetupParams:ae}=ve(),{searchResults:te,findMeetupDates:se}=Ae(),{defaultBaseDate:v,activeBaseDate:le,nextBaseDate:P,rotationCycleLength:x,scheduleUpdateDate:L,updateActiveBaseDate:M}=$(),w=H(()=>{const t=[];return v.value&&t.push({value:m(v.value),text:k(v.value)}),P.value&&P.value.isValid&&P.value.isValid()&&!(v.value&&m(v.value)===m(P.value))&&t.push({value:m(P.value),text:k(P.value)}),t}),oe=H(()=>L.value?k(L.value):"");function ne(t){const e=E(t);M(e),D.value&&(D.value=!1)}function F(){const t=d.value.map(S=>parseInt(S.position,10)).filter(S=>!isNaN(S));if(t.length===0){alert(B.NO_PARTICIPANTS);return}if(t.length===1){alert(B.GOAHEAD);return}const e=E(n.value),a=De(),I=ge(e,a)?e:a,C=ee(I,parseInt(r.value,10));se(t,l.value,I,C),D.value=!0,ae(n.value,d.value,{startTime:l.value,period:r.value})}async function ie(){try{if(!await o({defaultScheduleData:he,nextScheduleData:me,config:G,eventConfig:fe})){alert(B.INIT_FAILED);return}const e=[v.value,P.value].filter(Boolean),a=i("baseDate",void 0,e,G,x.value),I=g(),C=s("startTime",l.value),S=b("period",parseInt(r.value,10));if(a){const _=E(a);_.isValid()?(M(_),n.value=m(_)):(M(v.value),n.value=m(v.value))}else M(v.value),n.value=m(v.value);return I.length>0&&(d.value=I),C&&(l.value=C),S&&(r.value=S.toString()),d.value.map(_=>parseInt(_.position,10)).filter(_=>!isNaN(_)).length>=2&&setTimeout(()=>{F()},0),!0}catch{return alert(B.INIT_FAILED),!1}}return Se(le,t=>{t&&(n.value=m(t))}),ye(async()=>{await ie()}),(t,e)=>(p(),N(pe,{layout:"meetup","show-results":D.value},{"search-controls":h(()=>[f("div",Ie,[u(c)?(p(),N(Pe,{key:0,id:"baseDate",legend:"基準日","aria-label":"基準日を選択",modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=a=>n.value=a),options:w.value,formatter:u(k),"display-as-text":w.value.length===1,"schedule-update-notice":oe.value,onChange:ne},null,8,["modelValue","options","formatter","display-as-text","schedule-update-notice"])):T("",!0),u(c)?(p(),y("fieldset",Te,[e[6]||(e[6]=f("legend",null,"検索条件",-1)),f("div",Ee,[e[4]||(e[4]=f("label",{for:"meetupStartTime"},"飲会開始:",-1)),Q(f("select",{id:"meetupStartTime","aria-label":"飲み会開始時間","onUpdate:modelValue":e[1]||(e[1]=a=>l.value=a)},[(p(!0),y(W,null,X(u(_e),a=>(p(),y("option",{key:a,value:a},Y(a),9,Me))),128))],512),[[Z,l.value]])]),f("div",Ce,[e[5]||(e[5]=f("label",{for:"searchPeriod"},"検索期間:",-1)),Q(f("select",{id:"searchPeriod","aria-label":"検索期間","onUpdate:modelValue":e[2]||(e[2]=a=>r.value=a)},[(p(!0),y(W,null,X(u(be),a=>(p(),y("option",{key:a.value,value:a.value},Y(a.text),9,Ve))),128))],512),[[Z,r.value]])])])):T("",!0)])]),participants:h(()=>[u(c)?(p(),N(q,{key:0},{fallback:h(()=>e[7]||(e[7]=[f("div",{class:"loading-placeholder"},"Loading...",-1)])),default:h(()=>[J(u(O),{modelValue:d.value,"onUpdate:modelValue":e[3]||(e[3]=a=>d.value=a),"rotation-cycle-length":u(x)},null,8,["modelValue","rotation-cycle-length"])]),_:1})):T("",!0)]),"search-button":h(()=>[u(c)?(p(),y("button",{key:0,id:"findDatesBtn",class:"primary-btn action-btn",onClick:F}," 日程を検索 ")):T("",!0)]),results:h(()=>[D.value?(p(),N(q,{key:0},{fallback:h(()=>e[8]||(e[8]=[f("div",{class:"loading-placeholder"},"Loading...",-1)])),default:h(()=>[J(u(U),{results:u(te)},null,8,["results"])]),_:1})):T("",!0)]),_:1},8,["show-results"]))}},Ue=de(ke,[["__scopeId","data-v-b498cae8"]]);export{Ue as default};
