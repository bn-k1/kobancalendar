import{b as I,e as D,f as M,g as h,o as y,i as p,C as B,D as k,F as A,q as O,t as U}from"./vendor-DzBgbkkT.js";import{c as u,y as j,z as C,B as w,u as V,E as $,b as R,D as q,i as N,_ as T,q as H,x as _,g,f as z,r as L}from"./index-BwhcwQmh.js";import{V as F}from"./utils-mma0L5NJ.js";function P(r,t="",n="",d="",s=""){const a=C(r),i=G(`${t}-${n}-${d}`);return`${a}-${i}@${s}`}function G(r){let t=0;if(r.length===0)return t;for(let n=0;n<r.length;n++){const d=r.charCodeAt(n);t=(t<<5)-t+d,t=t&t}return Math.abs(t).toString(16)}function X(r,t){const n=F({name:t.calendar_name,timezone:t.timezone,prodId:{company:t.company,product:t.product,language:t.language}});return r.forEach(d=>{const{subject:s,startTime:a,endTime:i,date:v}=d,f=u(v),c=n.createEvent({summary:s,uid:P(f,s,a,i,t.uid_domain)});if(a&&i){const[x,b="00"]=a.split(":"),[m,S="00"]=i.split(":"),E=f.hour(parseInt(x,10)).minute(parseInt(b,10)).second(0).toDate(),l=f.hour(parseInt(m,10)).minute(parseInt(S,10)).second(0).toDate();c.start(E),c.end(l)}else c.allDay(!0),c.start(j(f))}),n}function J(r,t,n){const d=new Blob([r],{type:"text/calendar;charset=utf-8"}),s=URL.createObjectURL(d),a=document.createElement("a"),i=C(t),v=C(n);a.href=s,a.download=`schedule_${i}-${v}.ics`,a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(s)}function K(){const r=I(void 0),t=w(),{calculateScheduleRange:n}=V();function d(s,a,i,v,f){try{if(!s)return alert($.INVALID_STARTNUMBER),!1;r.value=void 0;const c=u(v),x=u(f),b=u(a),m=u(i),S=R(x,1);let E=S;m&&!q(b,m)&&N(m,S)&&(E=m);const l=n(c,E,s,b),e=X(l,t.icsExportConfig);return J(e.toString(),c,x),!0}catch(c){throw console.error($.ICS_EXPORT_ERROR,c),r.value=c,c}}return{exportError:D(()=>r.value),hasError:D(()=>r.value!==void 0),exportICS:d}}const Q={id:"exportSection",class:"control-group"},W={class:"export-date-selectors"},Y={class:"date-selector-group"},Z=["value"],ee={class:"date-selector-group"},te=["disabled"],ae=["value"],se=["disabled"],ne={__name:"ExportSection",props:{baseDate:{type:[Date,Object],required:!0},nextBaseDate:{type:[Date,Object],required:!0},startPosition:{type:Number,required:!1}},emits:["export","export-complete"],setup(r,{emit:t}){const n=r,d=t,s=I(""),a=I(""),{exportICS:i}=K(),v=D(()=>_(n.baseDate,n.nextBaseDate)?u(n.nextBaseDate):H()),f=D(()=>g(v.value)),c=D(()=>g(R(v.value,30))),x=D(()=>{const l=[];for(let e=0;e<90;e++){const o=R(v.value,e);l.push({value:g(o),text:z(o)})}return l}),b=D(()=>{if(!s.value)return[];const l=u(s.value);return x.value.filter(e=>{const o=u(e.value);return L(o,l)||_(o,l)})}),m=D(()=>s.value&&a.value);M(()=>{s.value=f.value,a.value=c.value});function S(){if(a.value){const l=u(s.value),e=u(a.value);!L(e,l)&&!_(e,l)&&(a.value="")}}function E(){if(m.value)try{i(n.startPosition,u(n.baseDate),u(n.nextBaseDate),u(s.value),u(a.value)),d("export-complete",{success:!0})}catch(l){d("export-complete",{success:!1,error:l})}}return(l,e)=>(y(),h("fieldset",Q,[e[6]||(e[6]=p("legend",null,"エクスポート",-1)),p("div",W,[p("div",Y,[B(p("select",{id:"exportStartDate","onUpdate:modelValue":e[0]||(e[0]=o=>s.value=o),"aria-label":"エクスポート開始日",class:"date-select",onChange:S},[e[2]||(e[2]=p("option",{value:"",disabled:""},"開始日を選択",-1)),(y(!0),h(A,null,O(x.value,o=>(y(),h("option",{key:o.value,value:o.value},U(o.text),9,Z))),128))],544),[[k,s.value]])]),e[4]||(e[4]=p("span",{class:"date-separator"},"から",-1)),p("div",ee,[B(p("select",{id:"exportEndDate","onUpdate:modelValue":e[1]||(e[1]=o=>a.value=o),"aria-label":"エクスポート終了日",class:"date-select",disabled:!s.value},[e[3]||(e[3]=p("option",{value:"",disabled:""},"終了日を選択",-1)),(y(!0),h(A,null,O(b.value,o=>(y(),h("option",{key:o.value,value:o.value},U(o.text),9,ae))),128))],8,te),[[k,a.value]])]),e[5]||(e[5]=p("span",{class:"date-separator"},"まで",-1)),p("button",{id:"exportButton",class:"export-button","aria-label":"ICSをダウンロード",disabled:!m.value,onClick:E}," ダウンロード ",8,se)])]))}},ue=T(ne,[["__scopeId","data-v-35f32bc0"]]);export{ue as default};
