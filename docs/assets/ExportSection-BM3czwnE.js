import{b as _,e as b,g as S,o as y,i as f,C as $,t as v,D as g,F as M,q as P,v as U}from"./vendor-DzBgbkkT.js";import{c as p,y as F,z as R,b as B,B as X,u as Y,E as T,D as N,q as A,A as D,F as k,G as w,i as j,P as q}from"./index-DNnBaDSp.js";import{V as H}from"./utils-mma0L5NJ.js";function V(c,e="",n="",u="",s=""){const a=R(c),l=z(`${e}-${n}-${u}`);return`${a}-${l}@${s}`}function z(c){let e=0;if(c.length===0)return e;for(let n=0;n<c.length;n++){const u=c.charCodeAt(n);e=(e<<5)-e+u,e=e&e}return Math.abs(e).toString(16)}function G(c,e){const n=H({name:e.calendar_name,timezone:e.timezone,prodId:{company:e.company,product:e.product,language:e.language}});return c.forEach(u=>{const{subject:s,startTime:a,endTime:l,date:h}=u,m=p(h),i=n.createEvent({summary:s,uid:V(m,s,a,l,e.uid_domain)});if(a&&l){const[t,o="00"]=a.split(":"),[r,d="00"]=l.split(":"),E=m.hour(parseInt(t,10)).minute(parseInt(o,10)).second(0).toDate(),x=m.hour(parseInt(r,10)).minute(parseInt(d,10)).second(0).toDate();i.start(E),i.end(x)}else i.allDay(!0),i.start(F(m))}),n}function J(c,e,n){const u=new Blob([c],{type:"text/calendar;charset=utf-8"}),s=URL.createObjectURL(u),a=document.createElement("a"),l=R(e),h=R(B(n,-1));a.href=s,a.download=`schedule_${l}-${h}.ics`,a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(s)}function K(){const c=_(""),e=_(void 0),n=X(),{calculateScheduleRange:u}=Y();function s(a,l,h,m,i){try{if(!l){alert(T.INVALID_STARTNUMBER);return}e.value=void 0;const t=N(A()),o=p(h),r=p(m);let d;if(i)d=p(i);else{const O=t.month(),C=t.year(),L=p(`${C}-${O+1}-${D.DEFAULT_EXPORTDAY}`);t.date()<D.DEFAULT_EXPORTDAY?d=t.date(D.DEFAULT_EXPORTDAY).subtract(1,"month"):d=L}let E=k(d,a);r&&!w(o,r)&&j(r,E)&&(E=r);const x=u(d,E,l,o),I=G(x,n.icsExportConfig);return J(I.toString(),d,E),!0}catch(t){throw console.error(T.ICS_EXPORT_ERROR,t),e.value=t,t}}return{exportMonths:c,exportError:b(()=>e.value),hasError:b(()=>e.value!==void 0),exportICS:s}}const Q={id:"exportSection",class:"control-group"},W={class:"form-group"},Z={id:"exportLabel"},ee=["value"],re={__name:"ExportSection",props:{baseDate:{type:[Date,Object],required:!0},nextBaseDate:{type:[Date,Object],required:!0},startPosition:{type:Number,required:!1}},emits:["export","export-complete"],setup(c,{emit:e}){const n=c,u=e,s=_(D.DEFAULT_EXPORT_MONTHS),{exportICS:a}=K(),l=b(()=>{const t=A(),o=t.month(),r=t.year(),d=p(`${r}-${o+1}-${D.DEFAULT_EXPORTDAY}`);return t.date()<D.DEFAULT_EXPORTDAY?t.date(D.DEFAULT_EXPORTDAY).subtract(1,"month"):d});function h(t){return`${p(t).format("M")}/${D.DEFAULT_EXPORTDAY}`}function m(){u("export",{months:parseInt(s.value,10)})}function i(){const t=parseInt(s.value,10),o=n.startPosition;try{a(t,o,p(n.baseDate),p(n.nextBaseDate),l.value),u("export-complete",{success:!0})}catch(r){u("export-complete",{success:!1,error:r})}}return(t,o)=>(y(),S("fieldset",Q,[o[2]||(o[2]=f("legend",null,"エクスポート",-1)),f("div",W,[f("label",Z,v(h(l.value))+"から",1),$(f("select",{id:"exportMonths","aria-label":"エクスポート期間を選択","onUpdate:modelValue":o[0]||(o[0]=r=>s.value=r),onChange:m},[(y(!0),S(M,null,P(U(q),r=>(y(),S("option",{key:r.value,value:parseInt(r.value)/30},v(r.text.replace("ヶ月","")),9,ee))),128))],544),[[g,s.value]]),o[1]||(o[1]=f("span",null,"ヶ月分",-1)),f("button",{id:"exportButton","aria-label":"ICSをダウンロード",onClick:i}," ダウンロード ")])]))}};export{re as default};
