import{b as M,e as m,w as X,g as I,o as R,i as D,C as $,D as L,F as T,q as k,t as w}from"./vendor-DSOO9KR3.js";import{c as i,r as U,I as N,u as q,E as P,b as h,s as V,i as E,_ as F,l as G,q as C,g as A,v as H,m as j,A as O,f as Y}from"./index-C56_2Xuv.js";import{V as z}from"./utils-mma0L5NJ.js";function J(s){try{return new URL(s).hostname}catch{return"localhost"}}function K(s,n="",e="",u="",r=""){const a=U(s),v=Q(`${n}-${e}-${u}`);return`${a}-${v}@${r}`}function Q(s){let n=0;if(s.length===0)return n;for(let e=0;e<s.length;e++){const u=s.charCodeAt(e);n=(n<<5)-n+u,n=n&n}return Math.abs(n).toString(16)}function W(s,n){const e=J(n),u=z({prodId:`-//${e}//${N.PRODUCT_NAME}//${N.LANGUAGE}`});return s.forEach(r=>{const{subject:a,startTime:v,endTime:d,date:_}=r,p=i(_),l=u.createEvent({summary:a,id:K(p,a,v,d,e)});if(v&&d){const[f,x="00"]=v.split(":"),[b,S="00"]=d.split(":"),y=p.hour(parseInt(f,10)).minute(parseInt(x,10)).second(0).toDate(),B=p.hour(parseInt(b,10)).minute(parseInt(S,10)).second(0).toDate();l.start(y),l.end(B)}else{const f=p.add(1,"day");l.allDay(!0),l.start(f.toDate()),l.end(f.toDate())}}),u}function Z(s,n,e){const u=new Blob([s],{type:"text/calendar;charset=utf-8"}),r=URL.createObjectURL(u),a=document.createElement("a"),v=U(n),d=U(e);a.href=r,a.download=`schedule_${v}-${d}.ics`,a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r)}function ee(){const s=M(void 0),{calculateScheduleRange:n}=q();function e(u,r,a,v,d,_){try{if(!u)return alert(P.INVALID_STARTNUMBER),!1;s.value=void 0;const p=i(v),l=i(d),f=i(r),x=i(a),b=h(l,1);let S=b;x&&!V(f,x)&&E(x,b)&&(S=x);const y=n(p,S,u,f),B=W(y,_);return Z(B.toString(),p,l),!0}catch(p){throw console.error(P.ICS_EXPORT_ERROR,p),s.value=p,p}}return{exportError:m(()=>s.value),hasError:m(()=>s.value!==void 0),exportICS:e}}const te={id:"exportSection",class:"control-group"},ae={class:"export-date-selectors"},se={class:"date-selector-group"},ne=["value"],re={class:"date-selector-group"},oe=["disabled"],le=["value"],ue=["disabled"],ce={__name:"ExportSection",props:{baseDate:{type:[Date,Object],required:!0},nextBaseDate:{type:[Date,Object],required:!0},startPosition:{type:Number,required:!1},url:{type:String,required:!0}},emits:["export","export-complete"],setup(s,{emit:n}){const e=s,u=n,r=M(""),a=M(""),{exportICS:v}=ee(),d=m(()=>C(e.baseDate,e.nextBaseDate)?i(e.nextBaseDate):G()),_=m(()=>A(d.value)),p=m(()=>{const c=h(H(d.value,1),-1);if(l.value){const t=h(e.nextBaseDate,-1);return A(E(c,t)?c:t)}return A(c)}),l=m(()=>!e.nextBaseDate||C(e.baseDate,e.nextBaseDate)?!1:j(e.nextBaseDate,e.baseDate));m(()=>l.value?h(e.nextBaseDate,-1):h(d.value,O.EXPORT_MAX_DAYS-1));const f=m(()=>{const c=[],t=l.value?Math.min(O.EXPORT_MAX_DAYS,e.nextBaseDate.diff(d.value,"day")):O.EXPORT_MAX_DAYS;for(let o=0;o<t;o++){const g=h(d.value,o);if(l.value&&!E(g,e.nextBaseDate))break;c.push({value:A(g),text:Y(g)})}return c}),x=m(()=>{if(!r.value)return[];const c=i(r.value);return f.value.filter(t=>{const o=i(t.value);return!(E(o,c)||l.value&&!E(o,e.nextBaseDate))})}),b=m(()=>r.value&&a.value);function S(){r.value=_.value,a.value=p.value}X([()=>e.baseDate,()=>e.nextBaseDate,()=>e.startPosition],()=>{S()},{immediate:!0});function y(){if(a.value){const c=i(r.value),t=i(a.value);(!j(t,c)&&!C(t,c)||l.value&&!E(t,e.nextBaseDate))&&(a.value="")}}function B(){if(b.value)try{v(e.startPosition,i(e.baseDate),i(e.nextBaseDate),i(r.value),i(a.value),e.url),u("export-complete",{success:!0})}catch(c){u("export-complete",{success:!1,error:c})}}return(c,t)=>(R(),I("fieldset",te,[t[6]||(t[6]=D("legend",null,"エクスポート",-1)),D("div",ae,[D("div",se,[$(D("select",{id:"exportStartDate","onUpdate:modelValue":t[0]||(t[0]=o=>r.value=o),"aria-label":"エクスポート開始日",class:"date-select",onChange:y},[t[2]||(t[2]=D("option",{value:"",disabled:""},"開始日を選択",-1)),(R(!0),I(T,null,k(f.value,o=>(R(),I("option",{key:o.value,value:o.value},w(o.text),9,ne))),128))],544),[[L,r.value]])]),t[4]||(t[4]=D("span",{class:"date-separator"},"から",-1)),D("div",re,[$(D("select",{id:"exportEndDate","onUpdate:modelValue":t[1]||(t[1]=o=>a.value=o),"aria-label":"エクスポート終了日",class:"date-select",disabled:!r.value},[t[3]||(t[3]=D("option",{value:"",disabled:""},"終了日を選択",-1)),(R(!0),I(T,null,k(x.value,o=>(R(),I("option",{key:o.value,value:o.value},w(o.text),9,le))),128))],8,oe),[[L,a.value]])]),t[5]||(t[5]=D("span",{class:"date-separator"},"まで",-1)),D("button",{id:"exportButton",class:"export-button","aria-label":"ICSをダウンロード",disabled:!b.value,onClick:B}," ダウンロード ",8,ue)])]))}},ve=F(ce,[["__scopeId","data-v-312ae905"]]);export{ve as default};
