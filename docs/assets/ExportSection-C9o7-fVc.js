import{b as v,e as y,g as x,o as b,i as h,C as M,t as _,v as C,D as B,F as L,q as P}from"./vendor-DzBgbkkT.js";import{c as D,r as U,v as I,b as $,x as F,u as N,E as O,y as g,l as R,m as k,z as A,B as w,i as T,A as f,P as V}from"./index-CQvPrqRW.js";import{V as j}from"./utils-mma0L5NJ.js";function H(o,e="",a="",u="",s=""){const n=I(o),d=X(`${e}-${a}-${u}`);return`${n}-${d}@${s}`}function X(o){let e=0;if(o.length===0)return e;for(let a=0;a<o.length;a++){const u=o.charCodeAt(a);e=(e<<5)-e+u,e=e&e}return Math.abs(e).toString(16)}function q(o,e){const a=j({name:e.calendar_name,timezone:e.timezone,prodId:{company:e.company,product:e.product,language:e.language}});return o.forEach(u=>{const{subject:s,startTime:n,endTime:d,date:m}=u,i=D(m),c=a.createEvent({summary:s,uid:H(i,s,n,d,e.uid_domain)});if(n&&d){const[l,t="00"]=n.split(":"),[r,p="00"]=d.split(":"),E=i.hour(parseInt(l,10)).minute(parseInt(t,10)).second(0).toDate(),S=i.hour(parseInt(r,10)).minute(parseInt(p,10)).second(0).toDate();c.start(E),c.end(S)}else c.allDay(!0),c.start(U(i))}),a}function z(o,e,a){const u=new Blob([o],{type:"text/calendar;charset=utf-8"}),s=URL.createObjectURL(u),n=document.createElement("a"),d=I(e),m=I($(a,-1));n.href=s,n.download=`schedule_${d}-${m}.ics`,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(s)}function Y(){const o=v(""),e=v(void 0),a=F(),{calculateScheduleRange:u}=N();function s(n,d,m,i){try{if(!d){alert(O.INVALID_STARTNUMBER);return}e.value=void 0;const c=g(R()),l=D(m),t=D(i);let r=k(l,c)||A(l,c)?g(l):c,p=w(r,n);t&&!A(l,t)&&T(t,p)&&(p=t),r=r.date(f.DEFAULT_EXPORTDAY),p=p.date(f.DEFAULT_EXPORTDAY);const E=u(r,p,d,l),S=q(E,a.icsExportConfig);return z(S.toString(),r,p),!0}catch(c){throw console.error(O.ICS_EXPORT_ERROR,c),e.value=c,c}}return{exportMonths:o,exportError:y(()=>e.value),hasError:y(()=>e.value!==void 0),exportICS:s}}const G={id:"exportSection",class:"control-group"},J={class:"form-group"},K={id:"exportLabel"},Q=["value"],te={__name:"ExportSection",props:{baseDate:{type:[Date,Object],required:!0},nextBaseDate:{type:[Date,Object],required:!0},startPosition:{type:Number,required:!1}},emits:["export","export-complete"],setup(o,{emit:e}){const a=o,u=e,s=v(f.DEFAULT_EXPORT_MONTHS),{exportICS:n}=Y(),d=y(()=>{const l=R(),t=D(a.baseDate);return t?T(t,l):!1});function m(l){return`${D(l).format("M")}/${f.DEFAULT_EXPORTDAY}`}function i(){u("export",{months:parseInt(s.value,10)})}function c(){const l=parseInt(s.value,10),t=a.startPosition;try{n(l,t,D(a.baseDate),D(a.nextBaseDate)),u("export-complete",{success:!0})}catch(r){u("export-complete",{success:!1,error:r})}}return(l,t)=>(b(),x("fieldset",G,[t[2]||(t[2]=h("legend",null,"エクスポート",-1)),h("div",J,[h("label",K,_(m(d.value?C(R)():o.baseDate))+"から",1),M(h("select",{id:"exportMonths","aria-label":"エクスポート期間を選択","onUpdate:modelValue":t[0]||(t[0]=r=>s.value=r),onChange:i},[(b(!0),x(L,null,P(C(V),r=>(b(),x("option",{key:r.value,value:parseInt(r.value)/30},_(r.text.replace("ヶ月","")),9,Q))),128))],544),[[B,s.value]]),t[1]||(t[1]=h("span",null,"ヶ月分",-1)),h("button",{id:"exportButton","aria-label":"ICSをダウンロード",onClick:c}," ダウンロード ")])]))}};export{te as default};
