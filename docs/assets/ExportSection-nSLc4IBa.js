import{b as M,e as f,w as j,g as B,o as I,i as D,C as w,D as T,F as L,q as P,t as U}from"./vendor-DzBgbkkT.js";import{c as u,s as N,v as k,w as V,u as q,E as $,b as h,x as F,i as _,_ as H,l as Y,r as A,g as R,y as z,m as X,A as O,f as G}from"./index-Desc59RA.js";import{V as J}from"./utils-mma0L5NJ.js";function K(o,s="",e="",d="",n=""){const a=k(o),i=Q(`${s}-${e}-${d}`);return`${a}-${i}@${n}`}function Q(o){let s=0;if(o.length===0)return s;for(let e=0;e<o.length;e++){const d=o.charCodeAt(e);s=(s<<5)-s+d,s=s&s}return Math.abs(s).toString(16)}function W(o,s){const e=J({name:s.calendar_name,timezone:s.timezone,prodId:{company:s.company,product:s.product,language:s.language}});return o.forEach(d=>{const{subject:n,startTime:a,endTime:i,date:p}=d,m=u(p),c=e.createEvent({summary:n,uid:K(m,n,a,i,s.uid_domain)});if(a&&i){const[v,b="00"]=a.split(":"),[x,S="00"]=i.split(":"),E=m.hour(parseInt(v,10)).minute(parseInt(b,10)).second(0).toDate(),y=m.hour(parseInt(x,10)).minute(parseInt(S,10)).second(0).toDate();c.start(E),c.end(y)}else c.allDay(!0),c.start(N(m))}),e}function Z(o,s,e){const d=new Blob([o],{type:"text/calendar;charset=utf-8"}),n=URL.createObjectURL(d),a=document.createElement("a"),i=k(s),p=k(e);a.href=n,a.download=`schedule_${i}-${p}.ics`,a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n)}function ee(){const o=M(void 0),s=V(),{calculateScheduleRange:e}=q();function d(n,a,i,p,m){try{if(!n)return alert($.INVALID_STARTNUMBER),!1;o.value=void 0;const c=u(p),v=u(m),b=u(a),x=u(i),S=h(v,1);let E=S;x&&!F(b,x)&&_(x,S)&&(E=x);const y=e(c,E,n,b),g=W(y,s.icsExportConfig);return Z(g.toString(),c,v),!0}catch(c){throw console.error($.ICS_EXPORT_ERROR,c),o.value=c,c}}return{exportError:f(()=>o.value),hasError:f(()=>o.value!==void 0),exportICS:d}}const te={id:"exportSection",class:"control-group"},ae={class:"export-date-selectors"},se={class:"date-selector-group"},ne=["value"],re={class:"date-selector-group"},oe=["disabled"],le=["value"],ue=["disabled"],ce={__name:"ExportSection",props:{baseDate:{type:[Date,Object],required:!0},nextBaseDate:{type:[Date,Object],required:!0},startPosition:{type:Number,required:!1}},emits:["export","export-complete"],setup(o,{emit:s}){const e=o,d=s,n=M(""),a=M(""),{exportICS:i}=ee(),p=f(()=>A(e.baseDate,e.nextBaseDate)?u(e.nextBaseDate):Y()),m=f(()=>R(p.value)),c=f(()=>{const l=h(z(p.value,1),-1);if(v.value){const t=h(e.nextBaseDate,-1);return R(_(l,t)?l:t)}return R(l)}),v=f(()=>!e.nextBaseDate||A(e.baseDate,e.nextBaseDate)?!1:X(e.nextBaseDate,e.baseDate));f(()=>v.value?h(e.nextBaseDate,-1):h(p.value,O.EXPORT_MAX_DAYS-1));const b=f(()=>{const l=[],t=v.value?Math.min(O.EXPORT_MAX_DAYS,e.nextBaseDate.diff(p.value,"day")):O.EXPORT_MAX_DAYS;for(let r=0;r<t;r++){const C=h(p.value,r);if(v.value&&!_(C,e.nextBaseDate))break;l.push({value:R(C),text:G(C)})}return l}),x=f(()=>{if(!n.value)return[];const l=u(n.value);return b.value.filter(t=>{const r=u(t.value);return!(_(r,l)||v.value&&!_(r,e.nextBaseDate))})}),S=f(()=>n.value&&a.value);function E(){n.value=m.value,a.value=c.value}j([()=>e.baseDate,()=>e.nextBaseDate,()=>e.startPosition],()=>{E()},{immediate:!0});function y(){if(a.value){const l=u(n.value),t=u(a.value);(!X(t,l)&&!A(t,l)||v.value&&!_(t,e.nextBaseDate))&&(a.value="")}}function g(){if(S.value)try{i(e.startPosition,u(e.baseDate),u(e.nextBaseDate),u(n.value),u(a.value)),d("export-complete",{success:!0})}catch(l){d("export-complete",{success:!1,error:l})}}return(l,t)=>(I(),B("fieldset",te,[t[6]||(t[6]=D("legend",null,"エクスポート",-1)),D("div",ae,[D("div",se,[w(D("select",{id:"exportStartDate","onUpdate:modelValue":t[0]||(t[0]=r=>n.value=r),"aria-label":"エクスポート開始日",class:"date-select",onChange:y},[t[2]||(t[2]=D("option",{value:"",disabled:""},"開始日を選択",-1)),(I(!0),B(L,null,P(b.value,r=>(I(),B("option",{key:r.value,value:r.value},U(r.text),9,ne))),128))],544),[[T,n.value]])]),t[4]||(t[4]=D("span",{class:"date-separator"},"から",-1)),D("div",re,[w(D("select",{id:"exportEndDate","onUpdate:modelValue":t[1]||(t[1]=r=>a.value=r),"aria-label":"エクスポート終了日",class:"date-select",disabled:!n.value},[t[3]||(t[3]=D("option",{value:"",disabled:""},"終了日を選択",-1)),(I(!0),B(L,null,P(x.value,r=>(I(),B("option",{key:r.value,value:r.value},U(r.text),9,le))),128))],8,oe),[[T,a.value]])]),t[5]||(t[5]=D("span",{class:"date-separator"},"まで",-1)),D("button",{id:"exportButton",class:"export-button","aria-label":"ICSをダウンロード",disabled:!S.value,onClick:g}," ダウンロード ",8,ue)])]))}},ve=H(ce,[["__scopeId","data-v-b440175f"]]);export{ve as default};
