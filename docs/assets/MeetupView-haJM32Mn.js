const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ParticipantsList-BGzExPk5.js","assets/vendor-CEXAHpd4.js","assets/index-1zRgIfvf.js","assets/utils-DW2mDBql.js","assets/index-CIMsvMtk.css","assets/ParticipantsList-CmpRlaRg.css","assets/ResultsDisplay-iLScsO0o.js","assets/ResultsDisplay-B75hVKlZ.css"])))=>i.map(i=>d[i]);
import{u as K,a as le,c as E,i as oe,b as Q,t as k,_ as ne,A as F,d as ie,e as re,f as O,g as m,h as ue,j as de,k as ce,w as ve,s as pe,l as fe,E as V,m as me,n as he,o as De,T as ge,P as Pe,p as U}from"./index-1zRgIfvf.js";import{b as y,a as _e,w as be,e as ye,c as B,n as h,o as p,j as T,S as x,s as j,p as r,q as z,g as f,f as b,A as G,F as H,l as $,t as q,B as J}from"./vendor-CEXAHpd4.js";import"./utils-DW2mDBql.js";function Ae(){const N=y({allMatches:[],partialMatches:[]}),{getScheduleForDate:R}=K(),{canAttendMeetup:w}=le();function A(l,u,d,c){const o={allMatches:[],partialMatches:[]};let i=E(d);const P=E(c);for(;oe(i,P);){const s=n(i,l,u);s.availablePositions.length===l.length?o.allMatches.push({date:i,availableCount:s.availablePositions.length,totalCount:l.length,details:s.details}):s.availablePositions.length>0&&o.partialMatches.push({date:i,availableCount:s.availablePositions.length,totalCount:l.length,details:s.details}),i=Q(i,1)}return o.allMatches.sort((s,D)=>k(s.date)-k(D.date)),o.partialMatches.sort((s,D)=>D.availableCount!==s.availableCount?D.availableCount-s.availableCount:k(s.date)-k(D.date)),N.value=o,o}function n(l,u,d){const c={availablePositions:[],details:[]};for(const o of u){const i=R(l,o),P=w(i,d);c.details.push({position:o,schedule:i,isAvailable:P}),P&&c.availablePositions.push(o)}return c}return{searchResults:N,findMeetupDates:A,checkDateForPositions:n}}const Ie={class:"search-controls"},Se={key:1,id:"meetupSettingsSection",class:"control-group"},Te={class:"form-group"},Ee=["value"],Me={class:"form-group"},Ce=["value"],ke={__name:"MeetupView",setup(N){const R=z(()=>U(()=>import("./ParticipantsList-BGzExPk5.js"),__vite__mapDeps([0,1,2,3,4,5]))),w=z(()=>U(()=>import("./ResultsDisplay-iLScsO0o.js"),__vite__mapDeps([6,2,1,3,4,7]))),A=y(!1),n=y(""),l=y(F.DEFAULT_MEETUP_START_TIME),u=y(F.DEFAULT_SEARCH_PERIOD.toString()),d=y([{position:""}]),{isLoaded:c,initializeApp:o}=ie(),{getDateParam:i,getNumberParam:P,getStringParam:s,getParticipantsFromParams:D,updateMeetupParams:W}=re(),{searchResults:X,findMeetupDates:Y}=Ae(),{defaultBaseDate:v,activeBaseDate:Z,nextBaseDate:I,rotationCycleLength:ee,updateActiveBaseDate:M}=K(),ae=_e(()=>{const t=[];return v.value&&t.push({value:m(v.value),text:O(v.value)}),I.value&&!(v.value&&m(v.value)===m(I.value))&&t.push({value:m(I.value),text:O(I.value)}),t});function te(t){const e=E(t);M(e)}function L(){const t=d.value.map(_=>parseInt(_.position,10)).filter(_=>!isNaN(_));if(t.length===0){alert(V.NO_PARTICIPANTS);return}if(t.length===1){alert(V.GOAHEAD);return}const e=E(n.value),a=me(),S=he(e,a)?e:a,C=Q(S,parseInt(u.value,10));Y(t,l.value,S,C),A.value=!0,W(n.value,d.value,{startTime:l.value,period:u.value})}async function se(){try{if(!await o({holidayData:fe,saturdayData:pe,weekdayData:ve,config:ce,eventConfig:de})){alert(V.INIT_FAILED);return}const e=[v.value,I.value].filter(Boolean),a=i("baseDate",void 0,e),S=D(),C=s("startTime",l.value),_=P("period",parseInt(u.value,10));if(a){const g=E(a);g.isValid()?(M(g),n.value=m(g)):(M(v.value),n.value=m(v.value))}else M(v.value),n.value=m(v.value);return S.length>0&&(d.value=S),C&&(l.value=C),_&&(u.value=_.toString()),d.value.map(g=>parseInt(g.position,10)).filter(g=>!isNaN(g)).length>=2&&setTimeout(()=>{L()},0),!0}catch{return alert(V.INIT_FAILED),!1}}return be(Z,t=>{t&&(n.value=m(t))}),ye(async()=>{await se()}),(t,e)=>(p(),B(ue,{layout:"meetup","show-results":A.value},{"search-controls":h(()=>[f("div",Ie,[r(c)?(p(),B(De,{key:0,id:"baseDate",legend:"基準日","aria-label":"基準日を選択",modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=a=>n.value=a),options:ae.value,formatter:r(O),onChange:te},null,8,["modelValue","options","formatter"])):T("",!0),r(c)?(p(),b("fieldset",Se,[e[6]||(e[6]=f("legend",null,"検索条件",-1)),f("div",Te,[e[4]||(e[4]=f("label",{for:"meetupStartTime"},"飲会開始:",-1)),G(f("select",{id:"meetupStartTime","aria-label":"飲み会開始時間","onUpdate:modelValue":e[1]||(e[1]=a=>l.value=a)},[(p(!0),b(H,null,$(r(ge),a=>(p(),b("option",{key:a,value:a},q(a),9,Ee))),128))],512),[[J,l.value]])]),f("div",Me,[e[5]||(e[5]=f("label",{for:"searchPeriod"},"検索期間:",-1)),G(f("select",{id:"searchPeriod","aria-label":"検索期間","onUpdate:modelValue":e[2]||(e[2]=a=>u.value=a)},[(p(!0),b(H,null,$(r(Pe),a=>(p(),b("option",{key:a.value,value:a.value},q(a.text),9,Ce))),128))],512),[[J,u.value]])])])):T("",!0)])]),participants:h(()=>[r(c)?(p(),B(x,{key:0},{fallback:h(()=>e[7]||(e[7]=[f("div",{class:"loading-placeholder"},"Loading...",-1)])),default:h(()=>[j(r(R),{modelValue:d.value,"onUpdate:modelValue":e[3]||(e[3]=a=>d.value=a),"rotation-cycle-length":r(ee)},null,8,["modelValue","rotation-cycle-length"])]),_:1})):T("",!0)]),"search-button":h(()=>[r(c)?(p(),b("button",{key:0,id:"findDatesBtn",class:"primary-btn action-btn",onClick:L}," 日程を検索 ")):T("",!0)]),results:h(()=>[A.value?(p(),B(x,{key:0},{fallback:h(()=>e[8]||(e[8]=[f("div",{class:"loading-placeholder"},"Loading...",-1)])),default:h(()=>[j(r(w),{results:r(X)},null,8,["results"])]),_:1})):T("",!0)]),_:1},8,["show-results"]))}},we=ne(ke,[["__scopeId","data-v-d5d7cb58"]]);export{we as default};
