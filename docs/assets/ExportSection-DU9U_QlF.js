import{b as C,e as f,w as X,f as h,o as I,g as p,C as O,D as L,F as U,q as $,t as M,n as q}from"./vendor-CJ74_EHT.js";import{c,I as V,r as N,u as F,E as P,b as _,s as H,i as R,_ as Y,l as w,q as y,g as j,m as k,A as T,f as z}from"./index-Cq2kEcX0.js";import"./utils-BuJoAw0M.js";function J(a){try{return new URL(a).hostname}catch{return"localhost"}}function K(a,v,e){const s=N(a),o=Date.now();return`${s}-${o}@${e}`}function B(a){return a.toISOString().replace(/[-:]/g,"").replace(/\.\d{3}/,"")}function G(a){return a.toISOString().slice(0,10).replace(/-/g,"")}function Q(a){return a.replace(/\\/g,"\\\\").replace(/;/g,"\\;").replace(/,/g,"\\,").replace(/\n/g,"\\n")}function W(a,v){const e=J(v);let s=["BEGIN:VCALENDAR","VERSION:2.0",`PRODID:-//${e}//${V.PRODUCT_NAME}//${V.LANGUAGE}`,"CALSCALE:GREGORIAN","METHOD:PUBLISH"];return a.forEach(o=>{const{subject:l,startTime:i,endTime:D,date:E}=o,n=c(E),m=K(n,l,e),x=Q(l);if(s.push("BEGIN:VEVENT"),s.push(`UID:${m}`),s.push(`SUMMARY:${x}`),s.push(`DTSTAMP:${B(new Date)}`),i&&D){const[d,S="00"]=i.split(":"),[b,A="00"]=D.split(":"),u=n.hour(parseInt(d,10)).minute(parseInt(S,10)).second(0).toDate(),t=n.hour(parseInt(b,10)).minute(parseInt(A,10)).second(0).toDate();s.push(`DTSTART:${B(u)}`),s.push(`DTEND:${B(t)}`)}else{const d=n.add(1,"day").toDate(),S=n.add(2,"day").toDate();s.push(`DTSTART;VALUE=DATE:${G(d)}`),s.push(`DTEND;VALUE=DATE:${G(S)}`)}s.push("END:VEVENT")}),s.push("END:VCALENDAR"),{toString:()=>s.join(`\r
`)}}function Z(a,v,e){const s=typeof a=="string"?a:a.toString(),o=new Blob([s],{type:"text/calendar;charset=utf-8"}),l=URL.createObjectURL(o),i=document.createElement("a"),D=N(v),E=N(e);i.href=l,i.download=`schedule_${D}-${E}.ics`,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(l)}function ee(){const a=C(void 0),{calculateScheduleRange:v}=F();function e(s,o,l,i,D,E){try{if(!s)return alert(P.INVALID_STARTNUMBER),!1;a.value=void 0;const n=c(i),m=c(D),x=c(o),d=c(l),S=_(m,1);let b=S;d&&!H(x,d)&&R(d,S)&&(b=d);const A=v(n,b,s,x),u=W(A,E);return Z(u.toString(),n,m),!0}catch(n){throw console.error(P.ICS_EXPORT_ERROR,n),a.value=n,n}}return{exportError:f(()=>a.value),hasError:f(()=>a.value!==void 0),exportICS:e}}const te={id:"exportSection",class:"control-group"},ae={class:"export-date-selectors"},se={class:"date-selector-group"},ne=["value"],re={class:"date-selector-group"},oe=["disabled"],le=["value"],ue=["disabled"],ce={__name:"ExportSection",props:{baseDate:{type:[Date,Object],required:!0},nextBaseDate:{type:[Date,Object],required:!0},startPosition:{type:Number,required:!1},url:{type:String,required:!0}},emits:["export","export-complete"],setup(a,{emit:v}){const e=a,s=v,o=C(""),l=C(""),{exportICS:i}=ee(),D=f(()=>y(e.baseDate,e.nextBaseDate)?c(e.nextBaseDate):w()),E=f(()=>j(w())),n=f(()=>!e.nextBaseDate||y(e.baseDate,e.nextBaseDate)?!1:k(e.nextBaseDate,e.baseDate));f(()=>n.value?_(e.nextBaseDate,-1):_(D.value,T.EXPORT_MAX_DAYS-1));const m=f(()=>{const u=[],t=n.value?Math.min(T.EXPORT_MAX_DAYS,e.nextBaseDate.diff(D.value,"day")):T.EXPORT_MAX_DAYS;for(let r=0;r<t;r++){const g=_(D.value,r);if(n.value&&!R(g,e.nextBaseDate))break;u.push({value:j(g),text:z(g)})}return u}),x=f(()=>{if(!o.value)return[];const u=c(o.value);return m.value.filter(t=>{const r=c(t.value);return!(R(r,u)||n.value&&!R(r,e.nextBaseDate))})}),d=f(()=>o.value&&l.value);function S(){o.value=E.value,l.value=""}X([()=>e.baseDate,()=>e.nextBaseDate,()=>e.startPosition],()=>{S()},{immediate:!0});function b(){if(l.value){const u=c(o.value),t=c(l.value);(!k(t,u)&&!y(t,u)||n.value&&!R(t,e.nextBaseDate))&&(l.value="")}}function A(){if(d.value)try{i(e.startPosition,c(e.baseDate),c(e.nextBaseDate),c(o.value),c(l.value),e.url),s("export-complete",{success:!0})}catch(u){s("export-complete",{success:!1,error:u})}}return(u,t)=>(I(),h("fieldset",te,[t[6]||(t[6]=p("legend",null,"エクスポート",-1)),p("div",ae,[p("div",se,[O(p("select",{id:"exportStartDate","onUpdate:modelValue":t[0]||(t[0]=r=>o.value=r),"aria-label":"エクスポート開始日",class:"date-select",onChange:b},[t[2]||(t[2]=p("option",{value:"",disabled:""},"開始日を選択",-1)),(I(!0),h(U,null,$(m.value,r=>(I(),h("option",{key:r.value,value:r.value},M(r.text),9,ne))),128))],544),[[L,o.value]])]),t[4]||(t[4]=p("span",{class:"date-separator"},"から",-1)),p("div",re,[O(p("select",{id:"exportEndDate","onUpdate:modelValue":t[1]||(t[1]=r=>l.value=r),"aria-label":"エクスポート終了日",class:"date-select",disabled:!o.value},[t[3]||(t[3]=p("option",{value:"",disabled:""},"終了日を選択",-1)),(I(!0),h(U,null,$(x.value,r=>(I(),h("option",{key:r.value,value:r.value},M(r.text),9,le))),128))],8,oe),[[L,l.value]])]),t[5]||(t[5]=p("span",{class:"date-separator"},"まで",-1)),p("button",{id:"exportButton",class:q(["export-button",{"export-button-enabled":d.value}]),"aria-label":"ICSをダウンロード",disabled:!d.value,onClick:A}," ダウンロード ",10,ue)])]))}},De=Y(ce,[["__scopeId","data-v-2ce1000b"]]);export{De as default};
