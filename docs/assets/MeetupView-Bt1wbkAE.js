const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ParticipantsList-5dzWSt9w.js","assets/vendor-DzBgbkkT.js","assets/index-CI3s3mMJ.js","assets/utils-mma0L5NJ.js","assets/index-mQZnRNcK.css","assets/ParticipantsList-CmpRlaRg.css","assets/ResultsDisplay-BxX0R-VL.js","assets/ResultsDisplay-BsFJHyil.css"])))=>i.map(i=>d[i]);
import{u as K,a as le,c as C,i as ne,b as Q,t as k,_ as oe,A as U,d as ie,e as ue,f as O,g as m,U as re,h as de,j as ce,n as ve,k as pe,l as fe,m as me,o as De,p as he,E as V,q as ge,r as Pe,s as _e,T as ye,P as be,v as F}from"./index-CI3s3mMJ.js";import{b as A,e as Se,w as Ae,f as Ie,c as x,s as D,o as p,m as T,S as H,k as z,v as u,x as G,i as f,g as S,C as j,F as q,q as W,t as $,D as J}from"./vendor-DzBgbkkT.js";import"./utils-mma0L5NJ.js";function Te(){const N=A({allMatches:[],partialMatches:[]}),{getScheduleForDate:R}=K(),{canAttendMeetup:B}=le();function h(l,r,d,c){const n={allMatches:[],partialMatches:[]};let i=C(d);const y=C(c);for(;ne(i,y);){const s=o(i,l,r);s.availablePositions.length===l.length?n.allMatches.push({date:i,availableCount:s.availablePositions.length,totalCount:l.length,details:s.details}):s.availablePositions.length>0&&n.partialMatches.push({date:i,availableCount:s.availablePositions.length,totalCount:l.length,details:s.details}),i=Q(i,1)}return n.allMatches.sort((s,g)=>k(s.date)-k(g.date)),n.partialMatches.sort((s,g)=>g.availableCount!==s.availableCount?g.availableCount-s.availableCount:k(s.date)-k(g.date)),N.value=n,n}function o(l,r,d){const c={availablePositions:[],details:[]};for(const n of r){const i=R(l,n),y=B(i,d);c.details.push({position:n,schedule:i,isAvailable:y}),y&&c.availablePositions.push(n)}return c}return{searchResults:N,findMeetupDates:h,checkDateForPositions:o}}const Ce={class:"search-controls"},Ee={key:1,id:"meetupSettingsSection",class:"control-group"},Me={class:"form-group"},ke=["value"],Ve={class:"form-group"},xe=["value"],Ne={__name:"MeetupView",setup(N){const R=G(()=>F(()=>import("./ParticipantsList-5dzWSt9w.js"),__vite__mapDeps([0,1,2,3,4,5]))),B=G(()=>F(()=>import("./ResultsDisplay-BxX0R-VL.js"),__vite__mapDeps([6,2,1,3,4,7]))),h=A(!1),o=A(""),l=A(U.DEFAULT_MEETUP_START_TIME),r=A(U.DEFAULT_SEARCH_PERIOD.toString()),d=A([{position:""}]),{isLoaded:c,initializeApp:n}=ie(),{getDateParam:i,getNumberParam:y,getStringParam:s,getParticipantsFromParams:g,updateMeetupParams:X}=ue(),{searchResults:Y,findMeetupDates:Z}=Te(),{defaultBaseDate:v,activeBaseDate:ee,nextBaseDate:P,rotationCycleLength:ae,updateActiveBaseDate:E}=K(),L=Se(()=>{const t=[];return v.value&&t.push({value:m(v.value),text:O(v.value)}),P.value&&P.value.isValid&&P.value.isValid()&&!(v.value&&m(v.value)===m(P.value))&&t.push({value:m(P.value),text:O(P.value)}),t});function te(t){const e=C(t);E(e),h.value&&(h.value=!1)}function w(){const t=d.value.map(b=>parseInt(b.position,10)).filter(b=>!isNaN(b));if(t.length===0){alert(V.NO_PARTICIPANTS);return}if(t.length===1){alert(V.GOAHEAD);return}const e=C(o.value),a=ge(),I=Pe(e,a)?e:a,M=Q(I,parseInt(r.value,10));Z(t,l.value,I,M),h.value=!0,X(o.value,d.value,{startTime:l.value,period:r.value})}async function se(){try{if(!await n({defaultHolidayData:he,defaultSaturdayData:De,defaultWeekdayData:me,nextHolidayData:fe,nextSaturdayData:pe,nextWeekdayData:ve,config:ce,eventConfig:de})){alert(V.INIT_FAILED);return}const e=[v.value,P.value].filter(Boolean),a=i("baseDate",void 0,e),I=g(),M=s("startTime",l.value),b=y("period",parseInt(r.value,10));if(a){const _=C(a);_.isValid()?(E(_),o.value=m(_)):(E(v.value),o.value=m(v.value))}else E(v.value),o.value=m(v.value);return I.length>0&&(d.value=I),M&&(l.value=M),b&&(r.value=b.toString()),d.value.map(_=>parseInt(_.position,10)).filter(_=>!isNaN(_)).length>=2&&setTimeout(()=>{w()},0),!0}catch{return alert(V.INIT_FAILED),!1}}return Ae(ee,t=>{t&&(o.value=m(t))}),Ie(async()=>{await se()}),(t,e)=>(p(),x(re,{layout:"meetup","show-results":h.value},{"search-controls":D(()=>[f("div",Ce,[u(c)?(p(),x(_e,{key:0,id:"baseDate",legend:"基準日","aria-label":"基準日を選択",modelValue:o.value,"onUpdate:modelValue":e[0]||(e[0]=a=>o.value=a),options:L.value,formatter:u(O),"display-as-text":L.value.length===1,onChange:te},null,8,["modelValue","options","formatter","display-as-text"])):T("",!0),u(c)?(p(),S("fieldset",Ee,[e[6]||(e[6]=f("legend",null,"検索条件",-1)),f("div",Me,[e[4]||(e[4]=f("label",{for:"meetupStartTime"},"飲会開始:",-1)),j(f("select",{id:"meetupStartTime","aria-label":"飲み会開始時間","onUpdate:modelValue":e[1]||(e[1]=a=>l.value=a)},[(p(!0),S(q,null,W(u(ye),a=>(p(),S("option",{key:a,value:a},$(a),9,ke))),128))],512),[[J,l.value]])]),f("div",Ve,[e[5]||(e[5]=f("label",{for:"searchPeriod"},"検索期間:",-1)),j(f("select",{id:"searchPeriod","aria-label":"検索期間","onUpdate:modelValue":e[2]||(e[2]=a=>r.value=a)},[(p(!0),S(q,null,W(u(be),a=>(p(),S("option",{key:a.value,value:a.value},$(a.text),9,xe))),128))],512),[[J,r.value]])])])):T("",!0)])]),participants:D(()=>[u(c)?(p(),x(H,{key:0},{fallback:D(()=>e[7]||(e[7]=[f("div",{class:"loading-placeholder"},"Loading...",-1)])),default:D(()=>[z(u(R),{modelValue:d.value,"onUpdate:modelValue":e[3]||(e[3]=a=>d.value=a),"rotation-cycle-length":u(ae)},null,8,["modelValue","rotation-cycle-length"])]),_:1})):T("",!0)]),"search-button":D(()=>[u(c)?(p(),S("button",{key:0,id:"findDatesBtn",class:"primary-btn action-btn",onClick:w}," 日程を検索 ")):T("",!0)]),results:D(()=>[h.value?(p(),x(H,{key:0},{fallback:D(()=>e[8]||(e[8]=[f("div",{class:"loading-placeholder"},"Loading...",-1)])),default:D(()=>[z(u(B),{results:u(Y)},null,8,["results"])]),_:1})):T("",!0)]),_:1},8,["show-results"]))}},we=oe(Ne,[["__scopeId","data-v-7c441279"]]);export{we as default};
