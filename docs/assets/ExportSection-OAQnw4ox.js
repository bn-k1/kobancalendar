import{b as C,e as D,w as L,g as y,o as _,i as p,C as A,D as O,F as k,q as w,t as M}from"./vendor-DzBgbkkT.js";import{c as l,y as T,z as R,B as j,u as N,E as U,b as B,D as P,i as V,_ as q,q as F,x as I,g,F as H,A as z,f as X,r as $}from"./index-CI3s3mMJ.js";import{V as G}from"./utils-mma0L5NJ.js";function Y(r,e="",s="",d="",n=""){const t=R(r),i=J(`${e}-${s}-${d}`);return`${t}-${i}@${n}`}function J(r){let e=0;if(r.length===0)return e;for(let s=0;s<r.length;s++){const d=r.charCodeAt(s);e=(e<<5)-e+d,e=e&e}return Math.abs(e).toString(16)}function K(r,e){const s=G({name:e.calendar_name,timezone:e.timezone,prodId:{company:e.company,product:e.product,language:e.language}});return r.forEach(d=>{const{subject:n,startTime:t,endTime:i,date:v}=d,f=l(v),u=s.createEvent({summary:n,uid:Y(f,n,t,i,e.uid_domain)});if(t&&i){const[x,b="00"]=t.split(":"),[m,S="00"]=i.split(":"),E=f.hour(parseInt(x,10)).minute(parseInt(b,10)).second(0).toDate(),h=f.hour(parseInt(m,10)).minute(parseInt(S,10)).second(0).toDate();u.start(E),u.end(h)}else u.allDay(!0),u.start(T(f))}),s}function Q(r,e,s){const d=new Blob([r],{type:"text/calendar;charset=utf-8"}),n=URL.createObjectURL(d),t=document.createElement("a"),i=R(e),v=R(s);t.href=n,t.download=`schedule_${i}-${v}.ics`,t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(n)}function W(){const r=C(void 0),e=j(),{calculateScheduleRange:s}=N();function d(n,t,i,v,f){try{if(!n)return alert(U.INVALID_STARTNUMBER),!1;r.value=void 0;const u=l(v),x=l(f),b=l(t),m=l(i),S=B(x,1);let E=S;m&&!P(b,m)&&V(m,S)&&(E=m);const h=s(u,E,n,b),c=K(h,e.icsExportConfig);return Q(c.toString(),u,x),!0}catch(u){throw console.error(U.ICS_EXPORT_ERROR,u),r.value=u,u}}return{exportError:D(()=>r.value),hasError:D(()=>r.value!==void 0),exportICS:d}}const Z={id:"exportSection",class:"control-group"},ee={class:"export-date-selectors"},te={class:"date-selector-group"},ae=["value"],se={class:"date-selector-group"},ne=["disabled"],oe=["value"],re=["disabled"],le={__name:"ExportSection",props:{baseDate:{type:[Date,Object],required:!0},nextBaseDate:{type:[Date,Object],required:!0},startPosition:{type:Number,required:!1}},emits:["export","export-complete"],setup(r,{emit:e}){const s=r,d=e,n=C(""),t=C(""),{exportICS:i}=W(),v=D(()=>I(s.baseDate,s.nextBaseDate)?l(s.nextBaseDate):F()),f=D(()=>g(v.value)),u=D(()=>g(B(H(v.value,1),-1))),x=D(()=>{const c=[];for(let a=0;a<z.EXPORT_MAX_DAYS;a++){const o=B(v.value,a);c.push({value:g(o),text:X(o)})}return c}),b=D(()=>{if(!n.value)return[];const c=l(n.value);return x.value.filter(a=>{const o=l(a.value);return $(o,c)||I(o,c)})}),m=D(()=>n.value&&t.value);function S(){n.value=f.value,t.value=u.value}L([()=>s.baseDate,()=>s.nextBaseDate,()=>s.startPosition],()=>{S()},{immediate:!0});function E(){if(t.value){const c=l(n.value),a=l(t.value);!$(a,c)&&!I(a,c)&&(t.value="")}}function h(){if(m.value)try{i(s.startPosition,l(s.baseDate),l(s.nextBaseDate),l(n.value),l(t.value)),d("export-complete",{success:!0})}catch(c){d("export-complete",{success:!1,error:c})}}return(c,a)=>(_(),y("fieldset",Z,[a[6]||(a[6]=p("legend",null,"エクスポート",-1)),p("div",ee,[p("div",te,[A(p("select",{id:"exportStartDate","onUpdate:modelValue":a[0]||(a[0]=o=>n.value=o),"aria-label":"エクスポート開始日",class:"date-select",onChange:E},[a[2]||(a[2]=p("option",{value:"",disabled:""},"開始日を選択",-1)),(_(!0),y(k,null,w(x.value,o=>(_(),y("option",{key:o.value,value:o.value},M(o.text),9,ae))),128))],544),[[O,n.value]])]),a[4]||(a[4]=p("span",{class:"date-separator"},"から",-1)),p("div",se,[A(p("select",{id:"exportEndDate","onUpdate:modelValue":a[1]||(a[1]=o=>t.value=o),"aria-label":"エクスポート終了日",class:"date-select",disabled:!n.value},[a[3]||(a[3]=p("option",{value:"",disabled:""},"終了日を選択",-1)),(_(!0),y(k,null,w(b.value,o=>(_(),y("option",{key:o.value,value:o.value},M(o.text),9,oe))),128))],8,ne),[[O,t.value]])]),a[5]||(a[5]=p("span",{class:"date-separator"},"まで",-1)),p("button",{id:"exportButton",class:"export-button","aria-label":"ICSをダウンロード",disabled:!m.value,onClick:h}," ダウンロード ",8,re)])]))}},ie=q(le,[["__scopeId","data-v-4bff5f0e"]]);export{ie as default};
